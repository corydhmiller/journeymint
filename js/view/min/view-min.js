var mintView=function(t){this.model=t,this.addAccomplishmintEvent=new Event(this),this.deleteAccomplishmintEvent=new Event(this),this.saveEditedAccomplishmintEvent=new Event(this),this.deleteItemTagClickEvent=new Event(this),this.updateStarLevelEvent=new Event(this),this.keyWasPressedEvent=new Event(this),this.init()};mintView.prototype={init:function(){this.createChildren().setupHandlers().enable()},createChildren:function(){return this.$appContainer=$(".app-container"),this.$appHeader=$(".app-header"),this.$appBody=$(".app-body"),this.$input=$(".accomplishmint__input"),this.$accomplishmintsList=$(".accomplishmints-list"),this.$accomplishmintContainer=$(".accomplishmint-container"),this.$messageContainer=$(".message-container"),this.$scoreTally=$(".app-score__tally"),this.$advancedContainer=$(".item__advanced"),this.$itemContainer=this.$accomplishmintsList.find(".item-container"),this.$itemTagInput=this.$accomplishmintsList.find(".item__tag__input"),this},setupHandlers:function(){return this.addAccomplishmintHandler=this.addAccomplishmint.bind(this),this.deleteAccomplishmintHandler=this.deleteAccomplishmint.bind(this),this.removeAccomplishmintFromViewHandler=this.removeAccomplishmintFromView.bind(this),this.editAccomplishmintHandler=this.editAccomplishmint.bind(this),this.saveEditedAccomplishmintHandler=this.saveEditedAccomplishmint.bind(this),this.buildListHandler=this.buildList.bind(this),this.displayNewEncouragementHandler=this.displayNewEncouragement.bind(this),this.rebuildItemCardHandler=this.rebuildItemCard.bind(this),this.updateStarLevelHandler=this.updateStarLevel.bind(this),this.updateTodaysScoreHandler=this.updateTodaysScore.bind(this),this.addItemTagHandler=this.addItemTag.bind(this),this.deleteItemTagHandler=this.deleteItemTag.bind(this),this.deleteItemTagClickHandler=this.deleteItemTagClick.bind(this),this.displayTagErrorHandler=this.displayTagError.bind(this),this.keyActionsHandler=this.keyActions.bind(this),this},enable:function(){return this.model.retrieveAccomplishmintsFromStorageEvent.attach(this.buildListHandler),this.model.addAccomplishmintEvent.attach(this.addAccomplishmintHandler,this.displayNewEncouragementHandler,this.updateTodaysScoreHandler),this.model.deleteAccomplishmintEvent.attach(this.removeAccomplishmintFromViewHandler,this.updateTodaysScoreHandler),this.model.saveEditedAccomplishmintEvent.attach(this.rebuildItemCardHandler,this.updateTodaysScoreHandler),this.model.addItemTagEvent.attach(this.addItemTagHandler),this.model.deleteItemTagEvent.attach(this.deleteItemTagHandler),this.model.displayTagErrorEvent.attach(this.displayTagErrorHandler),this.$input.keydown(this.keyActionsHandler),this.$accomplishmintsList.on("keydown",".editable-accomplishmint",this.keyActionsHandler),this.$accomplishmintsList.on("keydown",".item__tag__input",this.keyActionsHandler),this.$accomplishmintsList.on("keyup",".item__notes__input",this.keyActionsHandler),this.$accomplishmintsList.on("click",".accomplishmint-delete",this.deleteAccomplishmintHandler),this.$accomplishmintsList.on("click",".accomplishmint-edit",this.editAccomplishmintHandler),this.$accomplishmintsList.on("click",".accomplishmint-save",this.saveEditedAccomplishmintHandler),this.$accomplishmintsList.on("click",".accomplishmint__item-content--editable",this.editAccomplishmintHandler),this.$accomplishmintsList.on("click",".item__tag .item__close",this.deleteItemTagClickHandler),this.$accomplishmintsList.on("click",".item__stars label",this.updateStarLevelHandler),this},keyActions:function(t){this.keyWasPressedEvent.notify({event:t})},getParentItemContainerID:function(t){return $(t.target).parents(".item-container").attr("id")},updateTodaysScore:function(){var t=this.model.accomplishmints,i=0;for(var e in t)i+=t[e].score;this.$scoreTally.text(i)},addAccomplishmint:function(t,i){this.$accomplishmintsList.prepend(this.generateItemHTML(i.id,i.content)),this.clearAccomplishmintInput()},deleteAccomplishmint:function(t){this.deleteAccomplishmintEvent.notify({id:this.getParentItemContainerID(t)})},removeAccomplishmintFromView:function(t,i){$("#"+i.id).remove()},addClassForATime:function(t,i,e){t.removeClass(i),t.addClass(i),setTimeout(function(){t.removeClass(i)},e)},displayTagError:function(t,i){this.addClassForATime($("#advanced-"+i.id).find(".item__tag__input"),"input--error",1e3),this.addClassForATime($("#advanced-"+i.id).find(".item__tag__input"),"shake",1e3),this.addClassForATime($("#advanced-"+i.id).find("[data-tagid='"+i.tagid+"']"),"shake",1e3)},editAccomplishmint:function(t){var i=this.getParentItemContainerID(t),e=$("#"+i).find(".accomplishmint-container"),n=$("#advanced-"+i);e.addClass("accomplishmint-container--editable"),e.find(".accomplishmint__item-content").removeClass("accomplishmint__item-content--editable");var a=$("#"+i+" .accomplishmint__item .accomplishmint__item-content"),s=a.text();a.html('<input class="editable-accomplishmint" id="edit-'+i+'" data-id="'+i+'"/>'),$("#edit-"+i).val(s).focus(),n.addClass("item__advanced--open"),this.changeEditButtonToSaveButton(i)},changeEditButtonToSaveButton:function(t){var i=$("#"+t+" .accomplishmint-menu .accomplishmint-edit");i.removeClass("accomplishmint-edit").addClass("accomplishmint-save").text("Save")},saveEditedAccomplishmint:function(t){this.saveEditedAccomplishmintEvent.notify({event:t})},convertDateIntToString:function(t){var i=t.toString(),e=new Date(parseInt(i.substring(0,4),10),parseInt(i.substring(4,6),10)-1,parseInt(i.substring(6),10)),n=["January","February","March","April","May","June","July","August","September","October","November","December"];return n[e.getMonth()]+" "+e.getDate()+", "+e.getFullYear()},checkIfTodaysDateIsInArchive:function(){var t=this.model.getDateInt(),i=this.model.datesInArchive;for(var e in i){var n=jQuery.inArray(i[e].date,t);if(n)return!0}return!1},buildList:function(){var t=this.model.getAccomplishmints();this.$accomplishmintsList.html("");for(var i in t)this.$accomplishmintsList.prepend(this.generateItemHTML(t[i].id,t[i].content));this.clearAccomplishmintInput(),this.updateTodaysScore()},assignRandomColorClass:function(){var t=["item__tag--green","item__tag--lightgreen","item__tag--darkgreen"];return t[Math.floor(Math.random()*t.length)]},fetchTagsFromItem:function(t){var i=this.model.accomplishmints;t=parseInt(t);for(var e=0,n=i.length;n>e;e++)if(i[e].id===t)return i[e].tags},deleteItemTag:function(t,i){$("#advanced-"+i.id).find("[data-tagid='"+i.tagid+"']").remove()},deleteItemTagClick:function(t){this.deleteItemTagClickEvent.notify($(t.target).parent().data())},addItemTag:function(t,i){$("#"+i.id).find(".item__tags-list").append(this.generateSingleTagHTML(i.id,i.tagid,i.tagname)),$("#"+i.id).find(".item__tag__input").val("")},generateSingleTagHTML:function(t,i,e){var n='<span class="item__tag '+this.assignRandomColorClass()+'" data-tagid="'+i+'" data-id="'+t+'">'+e+' <span class="item__close">x</span></span>';return n},generateTagHTML:function(t){var i=this.fetchTagsFromItem(t),e=this.model.tags,n="";for(var a in i)for(var s in e)e[s].tagid===i[a]&&(n+=this.generateSingleTagHTML(t,e[s].tagid,e[s].tagname));return'<div class="item__tags"><small>Add some tags related to your accomplishmint:</small><br><div class="item__tags-list">'+n+'</div><input class="item__tag__input" data-id="'+t+'"/></div>'},generateItemCardHTML:function(t,i){return'<div data-id="'+t+'" class="card accomplishmint-container"><div class="accomplishmint__item"><span data-id="'+t+'" class="accomplishmint__item-content accomplishmint__item-content--editable">'+i+'</span></div><div class="accomplishmint-menu"><button data-id="'+t+'" class="accomplishmint-edit accomplishmint__button">Edit</button><button data-id="'+t+'" class="accomplishmint-delete accomplishmint__button">X</button></div></div>'},generateItemStarsHTML:function(t){var i='<div class="item__stars"><small>How did this accomplishmint make you feel?</small><br> <fieldset>',e=this.model.accomplishmints;for(var n in e)for(var a=1;4>=a;a++){var s=1;if(e[n].id===t){var d=e[n].stars;i=i+'<input type="radio" id="'+t+"-star"+a+'" name="'+t+'-star" value="'+a+'"',d===a&&(s++,i+="checked"),i=i+'><label for="'+t+"-star"+a+'">'+a+" stars</label>"}}return i+="</fieldset></div>"},updateStarLevel:function(t){var i=t.target.htmlFor,e=$(t.target).parents(".item-container").attr("id"),n=$("#"+i).val();this.updateStarLevelEvent.notify({id:e,starValue:n})},generateItemNotesHTML:function(t){var i=this.model.accomplishmints,e="";for(var n in i)i[n].id===t&&(e=i[n].notes);return'<div class="item__notes" data-id="'+t+'"><small>Add some notes about what you did:</small><br> <textarea class="item__notes__input" cols="40" rows="5">'+e+"</textarea></div>"},generateItemAdvancedMenuHTML:function(t,i){var e="";return i&&(e=" item__advanced--open"),'<div id="advanced-'+t+'" class="item__advanced'+e+'">'+this.generateTagHTML(t)+this.generateItemStarsHTML(t)+this.generateItemNotesHTML(t)+"</div>"},generateItemHTML:function(t,i){var e='<div id="'+t+'" class="item-container"> '+this.generateItemCardHTML(t,i)+this.generateItemAdvancedMenuHTML(t)+"</div>";return e},rebuildItemCard:function(t,i){$("#"+i.id).find(".accomplishmint-container").replaceWith(this.generateItemCardHTML(i.id,i.newcontent))},clearAccomplishmintInput:function(){this.$input.val("")},generateRandomEncouragement:function(){return this.model.encouragements[Math.floor(Math.random()*this.model.encouragements.length)]},displayNewEncouragement:function(){var t=this.generateRandomEncouragement(),i=$.now();this.model.messageZIndex++,this.$messageContainer.prepend('<div id="message__'+i+'" class="message" style="z-index:'+this.model.messageZIndex+'">'+t+"</div>"),$("#message__"+i).slideDown(250,"swing"),setTimeout(function(){$("#message__"+i).slideUp(250,"swing"),setTimeout(function(){$("#message__"+i).remove()},250)},3500)}};