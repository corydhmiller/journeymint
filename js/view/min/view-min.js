var mintView=function(t){this.model=t,this.addAccomplishmintEvent=new Event(this),this.deleteAccomplishmintEvent=new Event(this),this.saveEditedAccomplishmintEvent=new Event(this),this.deleteItemTagClickEvent=new Event(this),this.updateStarLevelEvent=new Event(this),this.keyWasPressedEvent=new Event(this),this.init()};mintView.prototype={init:function(){this.createChildren().setupHandlers().enable()},createChildren:function(){return this.$appContainer=$(".app-container"),this.$appHeader=$(".app-header"),this.$appBody=$(".app-body"),this.$input=$(".accomplishmint__input"),this.$accomplishmintsList=$(".accomplishmints-list"),this.$accomplishmintContainer=$(".accomplishmint-container"),this.$messageContainer=$(".message-container"),this.$scoreTally=$(".app-score__tally"),this.$advancedContainer=$(".item__advanced"),this.$itemContainer=this.$accomplishmintsList.find(".item-container"),this.$itemTagInput=this.$accomplishmintsList.find(".item__tag__input"),this},setupHandlers:function(){return this.addAccomplishmintHandler=this.addAccomplishmint.bind(this),this.deleteAccomplishmintHandler=this.deleteAccomplishmint.bind(this),this.removeAccomplishmintFromViewHandler=this.removeAccomplishmintFromView.bind(this),this.editAccomplishmintHandler=this.editAccomplishmint.bind(this),this.saveEditedAccomplishmintHandler=this.saveEditedAccomplishmint.bind(this),this.buildListHandler=this.buildList.bind(this),this.displayNewEncouragementHandler=this.displayNewEncouragement.bind(this),this.rebuildItemCardHandler=this.rebuildItemCard.bind(this),this.updateStarLevelHandler=this.updateStarLevel.bind(this),this.updateTodaysScoreHandler=this.updateTodaysScore.bind(this),this.addItemTagHandler=this.addItemTag.bind(this),this.deleteItemTagHandler=this.deleteItemTag.bind(this),this.deleteItemTagClickHandler=this.deleteItemTagClick.bind(this),this.displayTagErrorHandler=this.displayTagError.bind(this),this.keyActionsHandler=this.keyActions.bind(this),this.cacheDOMHandler=this.cacheDOM.bind(this),this},enable:function(){return this.model.retrieveAccomplishmintsFromStorageEvent.attach(this.buildListHandler),this.model.addAccomplishmintEvent.subscribe([this.displayNewEncouragementHandler,this.addAccomplishmintHandler,this.updateTodaysScoreHandler,this.cacheDOMHandler]),this.model.deleteAccomplishmintEvent.subscribe([this.removeAccomplishmintFromViewHandler,this.updateTodaysScoreHandler,this.cacheDOMHandler]),this.model.saveEditedAccomplishmintEvent.subscribe([this.rebuildItemCardHandler,this.updateTodaysScoreHandler,this.cacheDOMHandler]),this.model.addItemTagEvent.attach(this.addItemTagHandler),this.model.deleteItemTagEvent.attach(this.deleteItemTagHandler),this.model.displayTagErrorEvent.attach(this.displayTagErrorHandler),this.$input.keydown(this.keyActionsHandler),this.$accomplishmintsList.on("keydown",".editable-accomplishmint",this.keyActionsHandler),this.$accomplishmintsList.on("keydown",this.$itemTagInput,this.keyActionsHandler),this.$accomplishmintsList.on("click",".accomplishmint-delete",this.deleteAccomplishmintHandler),this.$accomplishmintsList.on("click",".accomplishmint-edit",this.editAccomplishmintHandler),this.$accomplishmintsList.on("click",".accomplishmint-save",this.saveEditedAccomplishmintHandler),this.$accomplishmintsList.on("click",".accomplishmint__item-content--editable",this.editAccomplishmintHandler),this.$accomplishmintsList.on("click",".item__tag .item__close",this.deleteItemTagClickHandler),this.$accomplishmintsList.on("click",".item__stars label",this.updateStarLevelHandler),this},cacheDOM:function(){this.createChildren()},keyActions:function(t){this.keyWasPressedEvent.notify({event:t})},getParentItemContainerID:function(t){return $(t.target).parents(".item-container").attr("id")},updateTodaysScore:function(){var t=this.model.accomplishmints,e=0;for(var i in t)e+=t[i].score;this.$scoreTally.text(e)},addAccomplishmint:function(t,e){this.$accomplishmintsList.prepend(this.generateItemHTML(e.id,e.content)),this.clearAccomplishmintInput()},deleteAccomplishmint:function(t){this.deleteAccomplishmintEvent.notify({id:this.getParentItemContainerID(t)})},removeAccomplishmintFromView:function(t,e){$("#"+e.id).remove()},addClassForATime:function(t,e,i){t.removeClass(e),t.addClass(e),setTimeout(function(){t.removeClass(e)},i)},displayTagError:function(t,e){this.addClassForATime($("#advanced-"+e.id).find(".item__tag__input"),"input--error",1e3),this.addClassForATime($("#advanced-"+e.id).find(".item__tag__input"),"shake",1e3),this.addClassForATime($("#advanced-"+e.id).find("[data-tagid='"+e.tagid+"']"),"shake",1e3)},editAccomplishmint:function(t){var e=this.getParentItemContainerID(t),i=$("#"+e).find(".accomplishmint-container"),n=$("#advanced-"+e);i.addClass("accomplishmint-container--editable"),i.find(".accomplishmint__item-content").removeClass("accomplishmint__item-content--editable");var a=$("#"+e+" .accomplishmint__item .accomplishmint__item-content"),s=a.text();a.html('<input class="editable-accomplishmint" id="edit-'+e+'" data-id="'+e+'"/>'),$("#edit-"+e).val(s).focus(),n.addClass("item__advanced--open"),this.changeEditButtonToSaveButton(e)},changeEditButtonToSaveButton:function(t){var e=$("#"+t+" .accomplishmint-menu .accomplishmint-edit");e.removeClass("accomplishmint-edit").addClass("accomplishmint-save").text("Save")},saveEditedAccomplishmint:function(t){this.saveEditedAccomplishmintEvent.notify({event:t})},convertDateIntToString:function(t){var e=t.toString(),i=new Date(parseInt(e.substring(0,4),10),parseInt(e.substring(4,6),10)-1,parseInt(e.substring(6),10)),n=["January","February","March","April","May","June","July","August","September","October","November","December"];return n[i.getMonth()]+" "+i.getDate()+", "+i.getFullYear()},checkIfTodaysDateIsInArchive:function(){var t=this.model.getDateInt(),e=this.model.datesInArchive;for(var i in e){var n=jQuery.inArray(e[i].date,t);if(n)return!0}return!1},buildList:function(){var t=this.model.getAccomplishmints();this.$accomplishmintsList.html("");for(var e in t)this.$accomplishmintsList.prepend(this.generateItemHTML(t[e].id,t[e].content));this.clearAccomplishmintInput(),this.updateTodaysScore(),this.cacheDOM()},assignRandomColorClass:function(){var t=["item__tag--green","item__tag--lightgreen","item__tag--darkgreen"];return t[Math.floor(Math.random()*t.length)]},fetchTagsFromItem:function(t){var e=this.model.accomplishmints;t=parseInt(t);for(var i=0,n=e.length;n>i;i++)if(e[i].id===t)return e[i].tags},deleteItemTag:function(t,e){$("#advanced-"+e.id).find("[data-tagid='"+e.tagid+"']").remove()},deleteItemTagClick:function(t){this.deleteItemTagClickEvent.notify($(t.target).parent().data())},addItemTag:function(t,e){$("#"+e.id).find(".item__tags-list").append(this.generateSingleTagHTML(e.id,e.tagid,e.tagname)),$("#"+e.id).find(".item__tag__input").val("")},generateSingleTagHTML:function(t,e,i){var n='<span class="item__tag '+this.assignRandomColorClass()+'" data-tagid="'+e+'" data-id="'+t+'">'+i+' <span class="item__close">x</span></span>';return n},generateTagHTML:function(t){var e=this.fetchTagsFromItem(t),i=this.model.tags,n="";for(var a in e)for(var s in i)i[s].tagid===e[a]&&(n+=this.generateSingleTagHTML(t,i[s].tagid,i[s].tagname));return'<div class="item__tags"><small>Add some tags related to your accomplishmint:</small><br><div class="item__tags-list">'+n+'</div><input class="item__tag__input" data-id="'+t+'"/></div>'},generateItemCardHTML:function(t,e){return'<div data-id="'+t+'" class="card accomplishmint-container"><div class="accomplishmint__item"><span data-id="'+t+'" class="accomplishmint__item-content accomplishmint__item-content--editable">'+e+'</span></div><div class="accomplishmint-menu"><button data-id="'+t+'" class="accomplishmint-edit accomplishmint__button">Edit</button><button data-id="'+t+'" class="accomplishmint-delete accomplishmint__button">X</button></div></div>'},generateItemStarsHTML:function(t){var e='<div class="item__stars"><small>How did this accomplishmint make you feel?</small><br> <fieldset>',i=this.model.accomplishmints;for(var n in i)for(var a=1;4>=a;a++){var s=1;if(i[n].id===t){var d=i[n].stars;e=e+'<input type="radio" id="'+t+"-star"+a+'" name="'+t+'-star" value="'+a+'"',d===a&&(s++,e+="checked"),e=e+'><label for="'+t+"-star"+a+'">'+a+" stars</label>"}}return e+="</fieldset></div>"},updateStarLevel:function(t){var e=t.target.htmlFor,i=$(t.target).parents(".item-container").attr("id"),n=$("#"+e).val();this.updateStarLevelEvent.notify({id:i,starValue:n})},generateItemNotesHTML:function(t){return'<div class="item__notes" data-id="'+t+'"><small>Add some notes about what you did:</small><br> <textarea class="item__notes__input" cols="40" rows="5"></textarea></div>'},generateItemAdvancedMenuHTML:function(t,e){var i="";return e&&(i=" item__advanced--open"),'<div id="advanced-'+t+'" class="item__advanced'+i+'">'+this.generateTagHTML(t)+this.generateItemStarsHTML(t)+this.generateItemNotesHTML()+"</div>"},generateItemHTML:function(t,e){var i='<div id="'+t+'" class="item-container"> '+this.generateItemCardHTML(t,e)+this.generateItemAdvancedMenuHTML(t)+"</div>";return i},rebuildItemCard:function(t,e){$("#"+e.id).find(".accomplishmint-container").replaceWith(this.generateItemCardHTML(e.id,e.newcontent))},clearAccomplishmintInput:function(){this.$input.val("")},generateRandomEncouragement:function(){return this.model.encouragements[Math.floor(Math.random()*this.model.encouragements.length)]},displayNewEncouragement:function(){var t=this.generateRandomEncouragement(),e=$.now();this.model.messageZIndex++,this.$messageContainer.prepend('<div id="message__'+e+'" class="message" style="z-index:'+this.model.messageZIndex+'">'+t+"</div>"),$("#message__"+e).slideDown(250,"swing"),setTimeout(function(){$("#message__"+e).slideUp(250,"swing"),setTimeout(function(){$("#message__"+e).remove()},250)},3500)}};